from telegram_parser import parse_channel

text = """üì£ **–°—Ç–∞–∂—ë—Ä Data Science –≤ Ozon Tech**

    –ü—Ä–æ–µ–∫—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–æ–Ω–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –≤–æ –≤—Ä–µ–º—è —Ä–∞—Å–ø—Ä–æ–¥–∞–∂

    **üìå –ó–∞–¥–∞—á–∏: **
    - —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –¥–ª—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    - –æ–±—É—á–µ–Ω–∏–µ CV-–º–æ–¥–µ–ª–µ–π, –ø—Ä–æ–¥—É–º—ã–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–∏–ø–æ—Ç–µ–∑, –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è
    - —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ - —Å–±–æ—Ä –¥–∞—Ç–∞—Å–µ—Ç–∞, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∏—á–µ–π
    - –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π, –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è —Å –º–µ—Ç–æ–¥–∞–º–∏ –¥–µ–ø–ª–æ—è –º–æ–¥–µ–ª–µ–π –≤ –ø—Ä–æ–¥
    - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –±–∏–∑–Ω–µ—Å-–∑–∞–∫–∞–∑—á–∏–∫–∞–º–∏ –∏ –ø–µ—Ä–µ–≤–æ–¥ –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –≤ –ø–ª–æ—Å–∫–æ—Å—Ç—å ML

    –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –æ—Ç 20 –ª–µ—Ç
    –ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç 0 –¥–æ 10 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü
    –ò–Ω–Ω–æ–ø–æ–ª–∏—Å
    –û—Ñ–∏—Å
    
[üëâüèº **–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –æ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–µ**](https://job.ozon.ru/vacancy/121749776?__rr=1&abt_att=1)"""


def test_parse_channel(mocker):
    mock_client = mocker.patch('telegram_parser.TelegramClient')
    mock_instance = mock_client.return_value.__enter__.return_value

    # Setup mock return values
    mock_message = mocker.Mock()
    mock_message.id = 0
    mock_message.text = text

    mock_instance.get_messages.return_value = [mock_message]

    assert len(parse_channel("")) == 1
    assert mock_client.call_count == 1

    mock_message.text = "some meaningless sheet"

    assert len(parse_channel("")) == 0
    assert mock_client.call_count == 2



